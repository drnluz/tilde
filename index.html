<!DOCTYPE html>
<html>
<head>
<title></title>
</head>
<body>

<script type="text/javascript">
class Utils {
  // https://github.com/jashkenas/underscore/blob/master/underscore.js#L87
  static isObject(obj) {
    var type = typeof obj
    return type === 'function' || type === 'object' && !!obj
  }
}

class StateTree {
  constructor(value, parent) {
    var _this = this
    this._parent = parent
    this._value = value

    Object.keys(value).forEach((key) => {
      if (Utils.isObject(value[key])) {
        value[key] = new StateTree(value[key], this)
      }

      Object.defineProperty(this, key, {
        set: (newValue) => {
          _this._value[key] = new StateTree(newValue, _this)
        },
        get: () => {
          return _this._value[key]
        }
      })
    })
  }
}

window.StateTree = StateTree
window.Utils = Utils
</script>

</body>
</html>
